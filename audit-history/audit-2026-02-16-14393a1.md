# Audit Report — 2026-02-16

## Commit: 14393a1

## Summary of Changes

Minor enhancements to core APIs and performance optimizations. All changes maintain backward compatibility and require no documentation updates.

## Detailed Findings

### 1. API Changes: Dynamic Home Directory Handling
**File:** `server/api-plugin.ts`

**Change:**
- `projectDirToReadableName()` now dynamically constructs home directory prefix using `homedir()` instead of hardcoded username patterns
- Builds `HOME_PREFIX` at module initialization from actual system home directory

**Documentation Impact:** None. This is an internal implementation detail of the API plugin. The behavior remains identical from the user perspective—directory names are still converted to human-readable format. No API contract changed.

---

### 2. API Change: Team Discovery Selection Logic
**File:** `server/api-plugin.ts` (lines ~1067-1183)

**Change:**
- `/api/team-info` endpoint now selects team by most recently created (`createdAt` timestamp) instead of first filesystem match
- Added `createdAt` field tracking when comparing teams
- Teams array now sorted by `createdAt` descending before returning

**Documentation Impact:** None. This is an internal implementation detail. The endpoint signature and response format unchanged. Only the selection logic for "primary team" changed, which is not documented API behavior.

---

### 3. Hook API Change: parsedSessionId Option
**File:** `src/hooks/usePtyChat.ts`

**Change:**
- Added optional `parsedSessionId` parameter to `UsePtyChatOpts` interface
- Hook now prefers `parsedSessionId` (actual UUID from JSONL) over filename-derived ID for `claude --resume`
- Fallback to filename-derived ID if `parsedSessionId` not provided

**Documentation Impact:** None. This is an internal implementation detail. The hook's public interface (props, return value, behavior) remains compatible. The session ID derivation improved but is transparent to callers.

---

### 4. UI Enhancement: Error Boundary Wrapper
**File:** `src/App.tsx` & `src/components/ErrorBoundary.tsx` (new)

**Changes:**
- New `ErrorBoundary` React class component wraps `ConversationTimeline` in both mobile and desktop layouts
- Catches rendering errors and displays fallback UI with retry button
- Includes error logging and message customization

**Documentation Impact:** None. This is an internal error handling improvement. No user-facing API or behavior change—just added safety for timeline rendering failures.

---

### 5. Performance Optimization: React.memo Wrapping
**Files:** Multiple timeline components

**Changes:**
- `src/components/ConversationTimeline.tsx`: Wrapped `TurnSection`, `CollapsibleToolCalls`, `CompactionMarker` with `React.memo()`
- `src/components/timeline/UserMessage.tsx`: Wrapped component with `React.memo()`
- `src/components/timeline/AssistantText.tsx`: Wrapped component with `React.memo()`
- `src/components/timeline/ToolCallCard.tsx`: Wrapped component with `React.memo()`
- `src/components/timeline/ThinkingBlock.tsx`: Wrapped component with `React.memo()`
- `src/components/timeline/SubAgentPanel.tsx`: Wrapped component with `React.memo()`

**Documentation Impact:** None. Memoization is a pure performance optimization with no behavioral changes. Components render identically; only skip unnecessary re-renders when props unchanged.

---

## Documentation Audit Result

**Conclusion:** No documentation updates needed.

All changes are internal implementation details or performance improvements that do not alter:
- Public API contracts (hooks, component props)
- User-facing behavior
- Configuration or setup requirements
- Feature functionality

Existing documentation (plans in `docs/plans/`) remains fully accurate. No README, API docs, or feature documentation requires updates.

## Bloat Reduction

No documentation bloat identified. Existing docs are concise and relevant.

## Action Items

None. All changes are self-contained and fully backward compatible.
